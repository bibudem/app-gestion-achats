<div class="container-fluid mt-5">
  <!-- En-tête -->
  <div class="row mb-4">
    <div class="col">
      <h1>Gestion des demandes d'achats</h1>
      <p class="text-muted">Liste des items de la base de données</p>
    </div>
  </div>

  <!-- Filtres et recherche -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="input-group">
        <input type="text" 
               class="form-control" 
               placeholder="Rechercher..." 
               [(ngModel)]="searchTerm"
               (keyup.enter)="onSearch()">
        <button class="btn btn-outline-secondary" (click)="onSearch()">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>
    <div class="col-md-3">
      <select class="form-select" [(ngModel)]="selectedType" (change)="onTypeChange()">
        <option value="">Tous les types</option>
        <option *ngFor="let type of typeOptions" [value]="type">
          {{ type }}
        </option>
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" [(ngModel)]="selectedStatus" (change)="onStatusChange()">
        <option value="">Tous les statuts</option>
        <option *ngFor="let status of statusOptions" [value]="status">
          {{ status }}
        </option>
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn btn-outline-secondary w-100" (click)="resetFilters()">
        Réinitialiser
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Tableau des items -->
  <div *ngIf="!loading" class="row">
    <div class="col">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Titre</th>
              <th>Type</th>
              <th>Bibliothèque</th>
              <th>Statut</th>
              <th>Prix</th>
              <th>Date création</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filteredItems">
              <td>{{ item.id_item }}</td>
              <td>
                <strong>{{ item.titre_document }}</strong>
                <div *ngIf="item.auteur" class="text-muted small">{{ item.auteur }}</div>
              </td>
              <td>
                <span class="badge bg-primary">{{ item.type_formulaire }}</span>
              </td>
              <td>{{ item.bibliotheque || 'Non spécifié' }}</td>
              <td>
                <span [class]="getStatusBadgeClass(item.bib_statut_demande)">
                  {{ item.bib_statut_demande || 'En attente' }}
                </span>
              </td>
              <td>{{ formatPrice(item.prix_cad) }}</td>
              <td>{{ formatDate(item.date_creation) }}</td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" 
                          (click)="viewItem(item.id_item)"
                          title="Consulter">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn btn-outline-danger" 
                          (click)="deleteItem(item.id_item)"
                          title="Supprimer">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <!-- Message si aucun résultat -->
        <div *ngIf="filteredItems.length === 0" class="text-center py-4">
          <p class="text-muted">Aucun item trouvé</p>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container-fluid mt-5">
  <!-- En-tête -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-2 mt-2">Gestion des demandes</h1>
          <p class="text-muted mb-0">Liste des items enregistrés</p>
        </div>
        <button 
          class="btn btn-primary" 
          [routerLink]="['/items/nouveau']">
          <i class="bi bi-plus-circle me-2"></i>Créer un item
        </button>
      </div>
      <hr>
    </div>
  </div>

  <!-- Filtres et recherche -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="input-group">
        <span class="input-group-text bg-light">
          <i class="bi bi-search"></i>
        </span>
        <input type="text" 
               class="form-control" 
               placeholder="Rechercher par titre, ISBN, demandeur..." 
               [(ngModel)]="searchTerm"
               (keyup.enter)="onSearch()"
               (input)="onSearch()">
      </div>
    </div>
    
    <div class="col-md-3">
      <select class="form-select form-control" [(ngModel)]="selectedBibliotheque" (change)="onBibliothequeChange()">
        <option value="">Toutes les bibliothèques</option>
        <option *ngFor="let bib of options.bibliothequeOptions" [value]="bib">
          {{ bib }}
        </option>
      </select>
    </div>
    
    <div class="col-md-2">
      <select class="form-select form-control"
              [(ngModel)]="selectedStatutBibliotheque"
              (change)="applyFilters()">
        <option value="">Statut bibliothèque</option>
        <option *ngFor="let statut of options.statusOptions" [value]="statut">
          {{ statut }}
        </option>
      </select>
    </div>
    <div class="col-md-2">
    <select class="form-select form-control"
            [(ngModel)]="selectedStatutAcq"
            (change)="applyFilters()">
      <option value="">Statut ACQ</option>
      <option *ngFor="let statut of options.dircolAcqStatutOptions" [value]="statut">
        {{ statut }}
      </option>
    </select>
  </div>
    <div class="col-md-1 d-flex gap-2">
      <button class="btn btn-warning w-100" (click)="resetFilters()">
        <i class="bi bi-arrow-clockwise"></i>
      </button>
    </div>
  </div>

  <!-- Indicateur de chargement -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-2">Chargement des données...</p>
  </div>

  <!-- Tableau des items -->
  <div *ngIf="!loading" class="row">
    <div class="col">
      <div class="card">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Titre</th>
                  <th>ISBN/ISSN</th>
                  <th>Demandeur</th>
                  <th>Bibliothèque</th>
                  <th>Catégorie</th>
                  <th>Statut</th>
                  <th>Date création</th>
                  <th class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of filteredItems" class="align-middle">
                  <td class="fw-semibold text-muted">
                    #{{ item.item_id }}
                  </td>
                  <td>
                    <div class="fw-semibold">{{ item.titre_document || 'Sans titre' }}</div>
                    <div class="small text-muted">
                      <span *ngIf="item.format_support">
                        • {{ getFormatSupport(item.format_support) }}
                      </span>
                    </div>
                  </td>
                  <td>
                    <div>{{ item.isbn_issn || 'Non spécifié' }}</div>
                    <div class="small text-muted" *ngIf="item.editeur">
                      Éditeur: {{ item.editeur }}
                    </div>
                  </td>
                  <td>
                    <div>{{ item.demandeur || 'Non spécifié' }}</div>
                  </td>
                  <td>
                    {{ item.bibliotheque || 'Non spécifié' }}
                    <div class="small text-muted" *ngIf="item.localisation_emplacement">
                      {{ item.localisation_emplacement }}
                    </div>
                  </td>
                  <td>
                    <span *ngIf="item.categorie_document" class="badge bg-light text-dark">
                      {{ item.categorie_document }}
                    </span>
                  </td>
                  <td>
                  <div class="small text-muted" *ngIf="item.localisation_emplacement">
                    {{ item.localisation_emplacement }}
                  </div>

                  <!-- Statuts -->
                  <div class="mt-2 d-flex flex-column gap-1">
                    <span *ngIf="item.statut_bibliotheque"
                          class="badge bg-info align-self-start">
                      Bib : {{ item.statut_bibliotheque }}
                    </span>

                    <span *ngIf="item.statut_acq"
                          class="badge bg-secondary align-self-start">
                      ACQ : {{ item.statut_acq }}
                    </span>
                  </div>
                </td>

                  <td>
                    <div>{{ formatDate(item.date_creation) }}</div>
                  </td>
                  <td class="text-center">
                    <div class="btn-group btn-group-sm" role="group">
                      <button class="btn btn-outline-primary" 
                              (click)="viewItem(item.item_id)"
                              title="Consulter">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-outline-danger ms-1" 
                              (click)="deleteItem(item.item_id)"
                              title="Supprimer">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Message si aucun résultat -->
      <div *ngIf="filteredItems.length === 0 && !loading" class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h5 class="mt-3">Aucun item trouvé</h5>
        <p class="text-muted">Essayez de modifier vos filtres ou créez un nouvel item</p>
        <button class="btn btn-primary mt-2" [routerLink]="['/items/nouveau']">
          <i class="bi bi-plus-circle me-2"></i>Créer un nouvel item
        </button>
      </div>
      
      <!-- Pagination/info -->
      <div *ngIf="filteredItems.length > 0" class="d-flex justify-content-between align-items-center mt-3">
      <div class="text-muted small">
        Affichage de {{ filteredItems.length }} sur {{ items.length }} items
      </div>
    </div>

    </div>
  </div>
</div>
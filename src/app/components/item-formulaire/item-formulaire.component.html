<div class="container-fluid">
  <!-- En-tête -->
  <div class="row mb-4 mt-5">
    <div class="col-md-12 mt-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-1">{{ isEditMode ? 'Modifier l\'item' : 'Ajouter un nouvel item' }}</h1>
          <p class="text-muted mb-0" *ngIf="itemId">ID: {{ itemId }}</p>
        </div>
        <div>
          <button class="btn btn-outline-secondary me-2" (click)="onCancel()">
            <i class="bi bi-arrow-left"></i> Retour
          </button>
          <button class="btn btn-success" (click)="onSubmit()" [disabled]="submitting || itemForm.invalid">
            <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2"></span>
            {{ isEditMode ? 'Modifier' : 'Créer' }}
          </button>
        </div>
      </div>
      <hr>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden"></span>
    </div>
    <p class="mt-2">Chargement...</p>
  </div>

  <!-- Formulaire -->
  <form [formGroup]="itemForm" *ngIf="!loading" class="needs-validation" novalidate>
    
    <!-- Onglet unique pour tous les champs -->
    <div class="card mb-4">
      <div class="card-header bg-light border-bottom">
        <h5 class="mb-0 mt-2">Informations de base</h5>
      </div>
      <div class="card-body p-4">
        
        <!-- Rangée 1 : Informations obligatoires -->
        <div class="row">
          <div class="col-md-8">
            <div class="mb-3">
              <label class="form-label fw-semibold">Titre du document <span class="text-danger">*</span></label>
              <input type="text" class="form-control" formControlName="titre_document"
                     [class.is-invalid]="hasError('titre_document', 'required')" 
                     placeholder="Titre complet du document">
              <div class="invalid-feedback" *ngIf="hasError('titre_document', 'required')">
                Le titre du document est obligatoire
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label fw-semibold">Demandeur <span class="text-danger">*</span></label>
              <input type="text" class="form-control" formControlName="demandeur"
                     [class.is-invalid]="hasError('demandeur', 'required')"
                     placeholder="Nom du demandeur">
              <div class="invalid-feedback" *ngIf="hasError('demandeur', 'required')">
                Le demandeur est obligatoire
              </div>
            </div>
          </div>
        </div>

        <!-- Rangée 2 : Sous-titre et Éditeur -->
        <div class="row">
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label fw-semibold">Sous-titre</label>
              <input type="text" class="form-control" formControlName="sous_titre" 
                     placeholder="Sous-titre du document">
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label fw-semibold">Éditeur</label>
              <input type="text" class="form-control" formControlName="editeur" 
                     placeholder="Nom de l'éditeur">
            </div>
          </div>
           <div class="col-md-2">
            <div class="mb-3">
              <label class="form-label fw-semibold">ISBN/ISSN</label>
              <input type="text" class="form-control" formControlName="isbn_issn" 
                     placeholder="Ex: 978-3-16-148410-0">
            </div>
          </div>
          <div class="col-md-2">
            <div class="mb-3">
              <label class="form-label fw-semibold">ID de ressource</label>
              <input type="text" class="form-control" formControlName="id_ressource">
            </div>
          </div>
        </div>

        <!-- Rangée 3 : Identifiants -->
        <div class="row">     
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Date de publication</label>
              <input type="date" class="form-control" formControlName="date_publication">
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Catégorie de document</label>
              <select class="form-select form-control" formControlName="categorie_document">
                <option value="">Sélectionnez</option>
                <option *ngFor="let cat of options.categorieDocumentOptions" [value]="cat">{{ cat }}</option>
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Format/Support</label>
              <select class="form-select form-control" formControlName="format_support">
                <option value="">Sélectionnez</option>
                <option value="Imprimé/support physique">Imprimé/support physique</option>
                <option value="Électronique">Électronique</option>
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Priorité</label>
              <select class="form-select form-control" formControlName="priorite_demande">
                <option *ngFor="let priorite of options.prioriteOptions" [value]="priorite.value">{{ priorite.label }}</option>
              </select>
            </div>
          </div>
        </div>
        <!-- Rangée 5 : Bibliothèque et Localisation -->
        <div class="row mb-3">
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Bibliothèque</label>
              <select class="form-select form-control" formControlName="bibliotheque">
                <option value="">Sélectionnez une bibliothèque</option>
                <option *ngFor="let bib of options.bibliothequeOptions" [value]="bib">{{ bib }}</option>
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Localisation/Emplacement</label>
              <input type="text" class="form-control" formControlName="localisation_emplacement">
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Projets spéciaux</label>
              <select class="form-select form-control" formControlName="projet_special">
                <option value="">Sélectionnez</option>
                <option *ngFor="let projet of options.projetsSpeciauxOptions" [value]="projet">{{ projet }}</option>
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Création notice DTDM</label>
              <select class="form-select form-control" formControlName="creation_notice_dtdm">
                <option [ngValue]="true">Oui</option>
                <option [ngValue]="false">Non</option>
              </select>
            </div>
          </div>
        </div>
           <!-- Rangée 9 : Statuts -->
        <div class="row">
           <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Fonds budgétaire <span class="text-danger">*</span></label>
              <input type="text" class="form-control" formControlName="fonds_budgetaire"
                     [class.is-invalid]="hasError('fonds_budgetaire', 'required')">
              <div class="invalid-feedback" *ngIf="hasError('fonds_budgetaire', 'required')">
                Le fonds budgétaire est obligatoire
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Fonds SN - No de projet</label>
              <input type="text" class="form-control" formControlName="fonds_sn_projet">
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Statut bibliothèque</label>
              <select class="form-select form-control" formControlName="statut_bibliotheque">
                <option *ngFor="let statut of options.statusOptions" [value]="statut">
                  {{ statut }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label fw-semibold">Statut ACQ </label>
              <select class="form-select form-control" formControlName="statut_acq">
                <option value="">Sélectionnez</option>
                <option *ngFor="let statut of options.dircolAcqStatutOptions"
                        [value]="statut">
                  {{ statut }}
                </option>
              </select>
            </div>
          </div>
        </div>
        <!-- Rangée 7 : Personnes à aviser -->
        <div class="row mb-3">
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label fw-semibold">Personne à aviser lors de l'activation</label>
              <input type="text" class="form-control" formControlName="personne_a_aviser_activation">
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label fw-semibold">Catalogue</label>
              <input type="text" class="form-control" formControlName="catalogue">
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label fw-semibold">Source d'information</label>
              <input type="text" class="form-control" formControlName="source_information">
            </div>
          </div>
        </div>

        <!-- Rangée 10 : Notes -->
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Note DTDM (Catalogage)</label>
              <textarea class="form-control" formControlName="note_dtdm" rows="3"></textarea>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Note/Commentaire (Bibliothèque)</label>
              <textarea class="form-control" formControlName="note_commentaire" rows="3"></textarea>
            </div>
          </div>
        </div>

        <!-- Rangée 11 : Métadonnées (lecture seule si édition) -->
        <div *ngIf="isEditMode" class="row mb-3 mt-5">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label text-info">Date de création: {{itemForm.get('date_creation')?.value | date:'yyyy-MM-dd HH:mm'}} </label>
              <br>
              <label class="form-label text-warning">Dernière modification: {{itemForm.get('date_modification')?.value | date:'yyyy-MM-dd HH:mm'}}</label>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="row mb-5 mt-3">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">
              <i class="bi bi-x-circle me-1"></i> Annuler
            </button>
          </div>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-success" (click)="onSubmit()" [disabled]="submitting || itemForm.invalid">
              <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2"></span>
              <i class="bi bi-check-lg me-1" *ngIf="!submitting"></i>
              {{ isEditMode ? 'Modifier l\'item' : 'Créer l\'item' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>